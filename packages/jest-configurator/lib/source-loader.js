var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.process=exports.getCacheKey=void 0;var babelJest=_interopRequireWildcard(require("babel-jest"));var _babelPresetJest=_interopRequireDefault(require("babel-preset-jest"));var _core=require("@babel/core");var _babelPluginIstanbul=_interopRequireDefault(require("babel-plugin-istanbul"));var _fs=require("fs");var _crypto=require("crypto");var _path=_interopRequireDefault(require("path"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var readSource=function readSource(filename){return(0,_fs.readFileSync)(filename).toString();};var isPackageFile=function isPackageFile(filename){return filename.includes("times-components");};var extensions=[".tsx",".ts",".js"];var pointToSource=function pointToSource(filename){var source=filename.replace("dist","src");var _path$parse=_path.default.parse(source),ext=_path$parse.ext;var pathWithoutExtension=source.substr(0,source.length-ext.length);var existingPath=extensions.reduce(function(result,extension){if(result)return result;return(0,_fs.existsSync)(""+pathWithoutExtension+extension)?""+pathWithoutExtension+extension:null;},null);return existingPath||filename;};var getPackageCacheKey=function getPackageCacheKey(filename){return(0,_crypto.createHash)("md5").update(readSource(pointToSource(filename))).digest("hex");};var getCacheKey=function getCacheKey(src,filename,config,cacheOptions){return isPackageFile(filename)?getPackageCacheKey(filename):babelJest.getCacheKey(src,filename,config,cacheOptions);};exports.getCacheKey=getCacheKey;var transform=function transform(src,targetFilename,_ref){var cwd=_ref.cwd,coveragePathIgnorePatterns=_ref.coveragePathIgnorePatterns;var source=src;var filename=targetFilename;if(isPackageFile(filename)){filename=pointToSource(filename);source=readSource(filename);}var transformResult=(0,_core.transform)(source,{filename:filename,plugins:[[_babelPluginIstanbul.default,{cwd:_path.default.join(cwd,"src"),exclude:coveragePathIgnorePatterns}]],presets:[_babelPresetJest.default]});return transformResult||source;};exports.process=transform;